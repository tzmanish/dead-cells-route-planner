(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();function e(){let e=document.createElement(`header`);return e.className=`bg-dc-header shadow-dc h-[60px]`,e.innerHTML=`
      <div class="mx-auto h-full px-4">
        <div class="flex justify-between items-end h-full">
          <div class="flex items-baseline gap-0 font-title font-bold text-5xl">
            Route
            <img src="/dead-cells-route-planner/logo.svg" alt="Dead Cells Route Planner Logo" class="h-[32px]"/>
            Planner
          </div>
        </div>
      </div>
    `,e}const t={BC0:0,BC1:1,BC2:2,BC3:3,BC4:4},n=new class{STORAGE_KEYS={ENABLED_DLCS:`dead-cells-enabled-dlcs`,DIFFICULTY:`dead-cells-difficulty`,SPOILER_PROTECTION:`dead-cells-spoiler-protection`};saveEnabledDLCs(e){try{localStorage.setItem(this.STORAGE_KEYS.ENABLED_DLCS,JSON.stringify(e))}catch(e){console.error(`Failed to save enabled DLCs to localStorage:`,e)}}loadEnabledDLCs(){try{let e=localStorage.getItem(this.STORAGE_KEYS.ENABLED_DLCS);return e?JSON.parse(e):null}catch(e){return console.error(`Failed to load enabled DLCs from localStorage:`,e),null}}saveDifficulty(e){try{localStorage.setItem(this.STORAGE_KEYS.DIFFICULTY,e)}catch(e){console.error(`Failed to save difficulty to localStorage:`,e)}}loadDifficulty(){try{return localStorage.getItem(this.STORAGE_KEYS.DIFFICULTY)}catch(e){return console.error(`Failed to load difficulty from localStorage:`,e),null}}saveSpoilerProtection(e){try{localStorage.setItem(this.STORAGE_KEYS.SPOILER_PROTECTION,JSON.stringify(e))}catch(e){console.error(`Failed to save spoiler protection to localStorage:`,e)}}loadSpoilerProtection(){try{let e=localStorage.getItem(this.STORAGE_KEYS.SPOILER_PROTECTION);return e===null?null:JSON.parse(e)}catch(e){return console.error(`Failed to load spoiler protection from localStorage:`,e),null}}clearAll(){try{Object.values(this.STORAGE_KEYS).forEach(e=>{localStorage.removeItem(e)})}catch(e){console.error(`Failed to clear localStorage:`,e)}}},r=new class{currentDifficulty;constructor(){this.loadFromStorage()}loadFromStorage(){let e=n.loadDifficulty();if(e!==null){let n=parseInt(e,10),r=Object.values(t);!isNaN(n)&&r.includes(n)?this.currentDifficulty=n:this.currentDifficulty=t.BC0}else this.currentDifficulty=t.BC0}saveToStorage(){n.saveDifficulty(this.currentDifficulty.toString())}set(e){this.currentDifficulty=e,this.saveToStorage()}getCurrent(){return this.currentDifficulty}getAll(){return Object.values(t)}getName(e){return`${e} BC`}},i=[{code:`FF`,name:`Fatal Falls`,key:`FatalFalls`,color:`#FFBE32`},{code:`RotG`,name:`Rise of the Giant`,key:`RiseOfTheGiant`,color:`#52f1f4`},{code:`RtC`,name:`Return to Castlevania`,key:`ReturnToCastlevania`,color:`#f02934`},{code:`TBS`,name:`The Bad Seed`,key:`TheBadSeed`,color:`#82C936`},{code:`TQatS`,name:`The Queen and the Sea`,key:`TheQueenAndTheSea`,color:`#B573E3`}],a=Object.fromEntries(i.map(e=>[e.key,e.code])),o=new class{enabledDlcs;constructor(){this.loadFromStorage()}loadFromStorage(){let e=n.loadEnabledDLCs();e===null?this.enabledDlcs=new Set(this.getAll()):this.enabledDlcs=new Set(e)}saveToStorage(){let e=[...this.enabledDlcs].filter(e=>e!==null);n.saveEnabledDLCs(e)}enable(e){e!==null&&(this.enabledDlcs.add(e),this.saveToStorage())}disable(e){e!==null&&(this.enabledDlcs.delete(e),this.saveToStorage())}getAll(){return Object.values(a)}getEnabled(){return[...this.enabledDlcs]}getShortName(e){return e===null?``:i.find(t=>t.code===e).code}getName(e){return e===null?``:i.find(t=>t.code===e).name}getColor(e){return e===null?``:i.find(t=>t.code===e).color}getDom(e){let t=document.createElement(`span`);return t.className=`font-bold`,t.style.color=this.getColor(e),t.textContent=this.getShortName(e),t.title=`${this.getName(e)} DLC`,t}isEnabled(e){return e===null?!0:this.enabledDlcs.has(e)}isDisabled(e){return!this.isEnabled(e)}filterByEnabledDLCs(e){return e.filter(e=>this.isEnabled(e.dlc))}},s=new class{spoilerProtectionEnabled;constructor(){this.loadFromStorage()}loadFromStorage(){let e=n.loadSpoilerProtection();e===null?this.spoilerProtectionEnabled=!0:this.spoilerProtectionEnabled=e}saveToStorage(){n.saveSpoilerProtection(this.spoilerProtectionEnabled)}isEnabled(){return this.spoilerProtectionEnabled}isDisabled(){return!this.spoilerProtectionEnabled}enable(){this.spoilerProtectionEnabled=!0,this.saveToStorage()}disable(){this.spoilerProtectionEnabled=!1,this.saveToStorage()}mask(e){if(this.isDisabled()||!e.is_spoiler)return e;let t=JSON.parse(JSON.stringify(e));return t.name=t.name.replace(/./g,`*`),t}},c=new class{listeners;constructor(){this.listeners=new Map}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{let n=this.listeners.get(e);n&&(n.delete(t),n.size===0&&this.listeners.delete(e))}}emit(e,t){let n=this.listeners.get(e);n&&n.forEach(e=>{e(t)})}clear(e){e?this.listeners.delete(e):this.listeners.clear()}};function l(e){let t=new FormData(e),n=parseInt(t.get(`boss-cell`)),r=new Set;t.getAll(`dlc`).forEach(e=>{r.add(e)});let i=t.get(`spoiler-protection`)===`on`;return{difficulty:n,dlcs:r,spoilerProtection:i}}function u(){return{difficulty:r.getCurrent(),dlcs:new Set(o.getEnabled()),spoilerProtection:s.isEnabled()}}function d(e,t){if(e.difficulty!==t.difficulty||e.spoilerProtection!==t.spoilerProtection||e.dlcs.size!==t.dlcs.size)return!0;for(let n of e.dlcs)if(!t.dlcs.has(n))return!0;return!1}function f(){let e=document.createElement(`div`);e.className=`flex flex-col items-start gap-1 py-2 px-6`;let t=document.createElement(`p`);t.className=`text-dc-gold text-sm text-left`,t.textContent=`Boss Cells`,e.appendChild(t);let n=document.createElement(`div`);return n.className=`flex flex-row flex-wrap gap-1`,r.getAll().forEach(e=>{let t=document.createElement(`label`);t.className=`flex items-center gap-2 cursor-pointer px-1`;let i=document.createElement(`input`);i.type=`radio`,i.name=`boss-cell`,i.value=e.toString(),i.className=`radio-dc`,e===r.getCurrent()&&(i.checked=!0);let a=document.createElement(`span`);a.className=`text-dc-gold-light text-sm`,a.textContent=r.getName(e),t.appendChild(i),t.appendChild(a),n.appendChild(t)}),e.appendChild(n),e}function p(){let e=document.createElement(`div`);e.className=`flex flex-col items-start gap-1 py-2 px-6`;let t=document.createElement(`p`);t.className=`text-dc-gold text-sm text-left`,t.textContent=`DLCs`,e.appendChild(t);let n=document.createElement(`div`);return n.className=`flex flex-row flex-wrap gap-1`,o.getAll().forEach(e=>{let t=document.createElement(`label`);t.className=`flex items-center gap-2 cursor-pointer px-1`;let r=document.createElement(`input`);r.type=`checkbox`,r.className=`checkbox-dc`,r.name=`dlc`,r.value=e,r.checked=o.isEnabled(e);let i=o.getDom(e);i.classList.add(`text-sm`),t.appendChild(r),t.appendChild(i),n.appendChild(t)}),e.appendChild(n),e}function m(){let e=document.createElement(`div`);e.className=`flex flex-col items-start justify-center gap-1 py-2 px-6`;let t=document.createElement(`label`);t.className=`flex items-center gap-2 cursor-pointer w-fit`;let n=document.createElement(`input`);n.type=`checkbox`,n.id=`spoiler-protection`,n.name=`spoiler-protection`,n.className=`checkbox-dc`,n.checked=s.isEnabled();let r=document.createElement(`span`);return r.className=`text-dc-gold text-sm`,r.textContent=`Spoiler protection`,t.appendChild(n),t.appendChild(r),e.appendChild(t),e}function h(e){let t=document.createElement(`div`);t.className=`flex flex-row justify-between gap-1 py-2 px-6`;let n=document.createElement(`button`);n.type=`submit`,n.className=`btn-dc-primary`,n.textContent=`Apply`,n.disabled=!0;let r=document.createElement(`button`);r.type=`button`,r.className=`btn-dc-secondary`,r.textContent=`Cancel`,r.disabled=!0;let i=()=>{let t=l(e),i=u(),a=d(t,i);n.disabled=!a,r.disabled=!a};return e.addEventListener(`change`,i),c.on(`control-panel-reset`,i),r.addEventListener(`click`,()=>{let t=u();e.querySelectorAll(`input[name="boss-cell"]`).forEach(e=>{let n=e;n.checked=parseInt(n.value)===t.difficulty}),e.querySelectorAll(`input[name="dlc"]`).forEach(e=>{let n=e;n.checked=t.dlcs.has(n.value)});let n=e.querySelector(`input[name="spoiler-protection"]`);n.checked=t.spoilerProtection,i()}),t.appendChild(n),t.appendChild(r),t}function g(){let e=document.createElement(`div`);e.className=`p-3 banner-dc`;let t=document.createElement(`form`);t.className=`flex flex-row flex-wrap gap-2 justify-center`;let n=f(),i=p(),a=m(),u=h(t);return t.appendChild(n),t.appendChild(i),t.appendChild(a),t.appendChild(u),t.addEventListener(`submit`,e=>{e.preventDefault();let n=l(t);r.set(n.difficulty),o.getAll().forEach(e=>{n.dlcs.has(e)?o.enable(e):o.disable(e)}),n.spoilerProtection?s.enable():s.disable(),console.log(`Settings applied:`,n),c.emit(`control-panel-reset`,n)}),e.appendChild(t),e}const _={L1:1,L2:2,O1:2.5,L3:3,B1:3.5,L4:4,L5:5,B2:5.5,L6:6,B3:6.5,L7:7,B4:8},v=Object.fromEntries(Object.entries(_).map(([e,t])=>{let n=``;switch(e.charAt(0)){case`L`:n=`Level`;break;case`O`:n=`Optional`;break;case`B`:n=`Boss`;break}return[t,`${n} ${e.slice(1)}`]})),y=new class{currentLevel;constructor(){this.currentLevel=_.L1}set(e){this.currentLevel=e}getCurrent(){return this.currentLevel}getAll(){return Object.values(_)}getName(e){return v[e]}};var b=class{biomeService;nextLevelMap;commulativeScrollCountMap;constructor(e){this.biomeService=e,this.nextLevelMap=new Map,this.commulativeScrollCountMap=new Map,this.recalculate()}getNextBiome(e){return this.nextLevelMap.get(e)}scrollCount(e){return this.commulativeScrollCountMap.get(e)}flattenCount(e){return e.power+e.cursed+e.dual+e.fragment/4}flatCommulativeScrollCount(e){let t=this.scrollCount(e);return t?this.flattenCount(t):0}flatCommulativeScrollCount_weighted(e){let t=this.scrollCount(e);return t?this.flattenCount(t):0}recalculate(){this.nextLevelMap.clear(),this.commulativeScrollCountMap.clear();let e=y.getAll(),t=r.getCurrent();for(let n=e.length-1;n>=0;n--){let r=this.biomeService.getBiomesByLevel(e[n]).map(e=>this.biomeService.getBiomeObject(e)).filter(e=>e!==void 0);o.filterByEnabledDLCs(r).forEach(e=>{if(e){let n=e.exits[t].map(e=>this.biomeService.getBiomeObject(e)).filter(e=>e!==void 0),r=o.filterByEnabledDLCs(n),i=null;r.length>0&&(i=r.reduce((e,t)=>t&&(!e||this.flatCommulativeScrollCount_weighted(t.name)>this.flatCommulativeScrollCount_weighted(e.name))?t:e));let a=e.scrolls[t],s=i?this.commulativeScrollCountMap.get(i.name):null;s&&(a={power:a.power+s.power,dual:a.dual+s.dual,fragment:a.fragment+s.fragment,cursed:+(a.cursed+s.cursed).toFixed(2)}),i&&this.nextLevelMap.set(e.name,i.name),this.commulativeScrollCountMap.set(e.name,a)}})}}};let x=function(e){return e.Standard=`standard`,e.Optional=`optional`,e.Boss=`boss`,e}({});function S(){return new Promise((e,t)=>{if(window.LeaderLine&&window.AnimEvent){e();return}let n=e=>new Promise((t,n)=>{let r=document.createElement(`script`);r.src=e,r.onload=()=>t(),r.onerror=()=>n(Error(`Failed to load ${e}`)),document.head.appendChild(r)});Promise.all([window.AnimEvent?Promise.resolve():n(`/dead-cells-route-planner/anim-event.min.js`),window.LeaderLine?Promise.resolve():n(`/dead-cells-route-planner/leader-line.min.js`)]).then(()=>e()).catch(t)})}function C(){O?.remove()}function w(e){let t=e.getBoundingClientRect();O&&(O.style.transform=`translate(${-t.left-window.pageXOffset}px, ${-t.top-window.pageYOffset}px)`)}function T(e){C(),O=document.createElement(`div`),O.className=`w-0 h-0 absolute top-0 left-0 z-100`,e.appendChild(O),w(e)}function E(e){return`linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url(${e})`}var D=null,O=null,k=new Map,A,j;function M(){j.recalculate(),S().then(()=>{D&&T(D);let e=A.getBiomesByLevel(_.L1)[0],t=k.get(e),n=j.getNextBiome(e),r=k.get(n||``);for(;n;){let e=new window.LeaderLine(t,r,{startSocket:`bottom`,endSocket:`top`,color:`#f9cf87`,size:1.2,path:`grid`}),i=document.querySelector(`body > .leader-line:last-child`);i&&O&&O.appendChild(i),t?.parentElement?.addEventListener(`scroll`,window.AnimEvent.add(()=>e.position()),!1),r?.parentElement?.addEventListener(`scroll`,window.AnimEvent.add(()=>e.position()),!1),c.on(`route-panel-reset`,()=>{t?.parentElement?.removeEventListener(`scroll`,window.AnimEvent.add(()=>e.position())),r?.parentElement?.removeEventListener(`scroll`,window.AnimEvent.add(()=>e.position()))}),r?.scrollIntoView(),t=r,n=j.getNextBiome(n),r=k.get(n||``)}window.scrollTo(0,0)}).catch(e=>{console.error(`Failed to load or use LeaderLine:`,e)}),k.forEach((e,t)=>{let n=A.getBiomeObject(t),i=r.getCurrent(),a=document.createElement(`h2`);a.className=`font-bold text-lg`,a.textContent=n?s.mask(n).name:t;let c=document.createElement(`a`);c.className=`link-dc ml-1 icon-[majesticons--open]`,c.href=A.getWikiURL(t),c.target=`_blank`,a.appendChild(c);let l=n?.scrolls[i],u=document.createElement(`span`),d=document.createElement(`span`);d.className=`icon-[majesticons--scroll]`;let f=document.createElement(`span`);f.textContent=l?`${Math.floor(j.flattenCount(l))}`:`-`,u.title=`Scrolls in this Level: `+(l?`${l.power} Power + ${l.cursed} Cursed + ${l.dual} Dual + ${l.fragment} Fragments`:`data unavailable`),u.replaceChildren(d,f);let p=j.scrollCount(t),m=document.createElement(`span`),h=document.createElement(`span`);h.className=`icon-[majesticons--scroll-text]`;let g=document.createElement(`span`);g.textContent=p?`${Math.floor(j.flattenCount(p))}`:`-`,m.className=`px-2`,m.title=`Scrolls in this Route: `+(p?`${p.power} Power + ${p.cursed} Cursed + ${p.dual} Dual + ${p.fragment} Fragments`:`data unavailable`),m.replaceChildren(h,g);let _=document.createElement(`div`);_.className=`absolute top-0 left-0 m-1 flex`;let v=document.createElement(`div`);v.className=`absolute top-0 right-0 flex`;let y=n.dlc||null;if(y!==null){let e=o.getDom(y);e.classList.add(`text-xs`,`bg-black`,`px-2`),v.appendChild(e)}if((n?.type||x.Standard)==x.Boss){let e=document.createElement(`span`);e.className=`icon-[majesticons--skull] bg-dc-red`,e.title=`Boss`,_.appendChild(e)}if(o.isDisabled(y)){let e=document.createElement(`span`);e.className=`icon-[majesticons--lock] bg-dc-red`,e.title=`Locked DLC`,_.appendChild(e)}e.replaceChildren(v,_,a,u,m)}),c.emit(`route-panel-reset`)}function N(e){let t=100*(598/168),n=document.createElement(`button`),r=A.getImageURL(e);n.className=`
        p-2 inline-block relative bg-center bg-no-repeat z-10
        cursor-pointer active:outline-2 
        bg-[length:100%_100%] hover:bg-[length:110%_110%] transition-[background-size] duration-400 ease-out
    `,n.style.height=`100px`,n.style.width=`${t}px`,n.style.minWidth=`${t}px`,n.style.backgroundImage=`url(/dead-cells-route-planner/biome_placeholder.svg)`;let i=new Image;return i.src=r,i.onload=()=>n.style.backgroundImage=E(r),n}function P(e){let t=document.createElement(`div`);t.className=`border-dashed border-dc-separator py-8 relative`,e!=_.L1&&t.classList.add(`border-t-1`);let n=document.createElement(`span`);n.innerHTML=y.getName(e),n.className=`absolute left-0 top-0 text-sm font-bold text-dc-separator`,t.appendChild(n);let r=document.createElement(`div`);return r.className=`overflow-x-auto flex justify-center-safe gap-4`,A.getBiomesByLevel(e).forEach(e=>{let t=k.get(e);t&&r.appendChild(t)}),t.appendChild(r),t}function F(e){let t=document.createElement(`div`);return D=t,D.className=`p-4 relative overflow-hidden`,A=e,j=new b(A),A.getAllBiomes().forEach(e=>k.set(e,N(e))),y.getAll().forEach(e=>{let t=P(e);D?.appendChild(t)}),M(),c.on(`control-panel-reset`,M),window.onresize=()=>w(D),t}var I=class{wiki_base;biomeMap;levelMap;constructor(e){this.wiki_base=e.wiki_base,this.biomeMap=new Map,this.levelMap=new Map,y.getAll().forEach(e=>this.levelMap.set(e,new Set)),e.biomes.forEach(e=>{this.biomeMap.set(e.name,e),this.levelMap.get(e.level)?.add(e.name)})}getAbsoluteWikiLink(e){return e.startsWith(this.wiki_base)?e:`${this.wiki_base}${e}`}getAllBiomes(){return[...this.biomeMap.values()].map(e=>e.name)}getBiomeObject(e){return this.biomeMap.get(e)}getBiomesByLevel(e){return[...this.levelMap.get(e)||new Set]}getBiomesByDLC(e){return[...this.biomeMap.values()].filter(t=>t.dlc===e).map(e=>e.name)}getWikiURL(e){return this.getAbsoluteWikiLink(this.getBiomeObject(e)?.wiki||``)}getImageURL(e){let t=this.getBiomeObject(e)?.image;return t?this.getAbsoluteWikiLink(t):`/dead-cells-route-planner/biome_placeholder.svg`}};async function L(){try{let e=await(await fetch(`/dead-cells-route-planner/biomes.json`)).json();return new I(e)}catch(e){throw console.error(`Failed to load biome data:`,e),e}}const R=L();function z(){let e=document.createElement(`div`);return e.className=`text-dc-gold text-center p-8 text-xl`,e.textContent=`Initializing Biome Service...`,e}function B(){let e=document.createElement(`div`);return e.className=`text-red-500 text-center p-8 text-xl`,e.textContent=`Failed to load Biome Service. Please refresh the page.`,e}function V(){let e=document.createElement(`main`);e.className=`flex-1`,e.appendChild(g());let t=z();return e.appendChild(t),R.then(n=>{e.removeChild(t),e.appendChild(F(n))}).catch(n=>{console.error(`Failed to load biome service:`,n),e.removeChild(t),e.appendChild(B())}),e}function H(){let e=document.createElement(`footer`);return e.className=`text-center bg-dc-footer py-6`,e.innerHTML=`
    <div class="mx-auto text-dc-gray">
      <p class="text-sm">&copy; 2025 Dead Cells Route Planner</p>
      <p class="text-sm">Fan-made tool for Dead Cells by Motion Twin</p>
    </div>
  `,e}var U=document.querySelector(`#app`),W=document.createElement(`div`);W.className=`flex flex-col min-h-screen bg-dc-dark`,W.appendChild(e()),W.appendChild(V()),W.appendChild(H()),U.appendChild(W);